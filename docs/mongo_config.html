---

title: Mongo tools


keywords: fastai
sidebar: home_sidebar



nb_path: "00_mongo_config.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: 00_mongo_config.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<center><strong style="font-size:40px">Config</strong></center>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The <code>config</code> mainly contains database connection info. An example is saved with this repo but ideally it should be moved somewhere else.
As usual, we start by reading the <code>config</code> and storing it as a dictionary.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="read_config" class="doc_header"><code>read_config</code><a href="https://git.uk/machine-learning/data-science-and-statistical-learning/am_combiner/tree/master/am_combiner/config.py#L16" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>read_config</code>(<strong><code>json_path</code></strong>:<code>str</code>=<em><code>'config.json'</code></em>)</p>
</blockquote>
<p>Read json config file</p>
<h2 id="Parameters">Parameters<a class="anchor-link" href="#Parameters"> </a></h2><p>json_path: str, optional
    Path to the project json config file. Default is to use the one found at root directory</p>
<h2 id="Returns">Returns<a class="anchor-link" href="#Returns"> </a></h2><p>dict
    with the data contained in the config file.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="recursive_get" class="doc_header"><code>recursive_get</code><a href="https://git.uk/machine-learning/data-science-and-statistical-learning/am_combiner/tree/master/am_combiner/config.py#L34" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>recursive_get</code>(<strong><code>d</code></strong>:<code>Dict</code>[<code>KT</code>, <code>VT</code>], <strong>*<code>args</code></strong>, <strong><code>default</code></strong>=<em><code>None</code></em>)</p>
</blockquote>
<p>Recursive implementation of dictionary value extraction</p>
<h2 id="Parameters">Parameters<a class="anchor-link" href="#Parameters"> </a></h2><p>d: dict
    dictionary
*args: dict
    path to the field required in <code>d</code>
default: dict
    value to be returned if nothing is found. Default to `None</p>
<h2 id="Returns">Returns<a class="anchor-link" href="#Returns"> </a></h2><p>dict
    value found at the given path provided in <code>*args</code></p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Connection">Connection<a class="anchor-link" href="#Connection"> </a></h2><p>The first step is to establish connection to mongo-database:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="mongo_connect" class="doc_header"><code>mongo_connect</code><a href="https://git.uk/machine-learning/data-science-and-statistical-learning/am_combiner/tree/master/am_combiner/config.py#L63" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>mongo_connect</code>(<strong><code>config</code></strong>:<code>dict</code>, <strong><code>host_name</code></strong>:<code>str</code>=<em><code>'playground'</code></em>)</p>
</blockquote>
<p>Establish connection to the project's mongoDB</p>
<h2 id="Parameters">Parameters<a class="anchor-link" href="#Parameters"> </a></h2><p>config : dict
    Project config dictionary
host_name : str, optional
    Host name (should be defined in config)</p>
<h2 id="Returns">Returns<a class="anchor-link" href="#Returns"> </a></h2><p>MongoClient
    MongoClient to the project mongod instance</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Reading-data">Reading data<a class="anchor-link" href="#Reading-data"> </a></h2><p>The next step is to define a reading function allowing to convert the mongo cursor to a <code>Pandas.DataFrame</code>.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="read_mongo" class="doc_header"><code>read_mongo</code><a href="https://git.uk/machine-learning/data-science-and-statistical-learning/am_combiner/tree/master/am_combiner/config.py#L83" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>read_mongo</code>(<strong><code>mongo_client</code></strong>:<code>MongoClient</code>, <strong><code>db</code></strong>:<code>str</code>, <strong><code>col</code></strong>:<code>str</code>, <strong><code>query</code></strong>:<code>Dict</code>[<code>KT</code>, <code>VT</code>]=<em><code>{}</code></em>, <strong><code>fields</code></strong>:<code>Dict</code>[<code>KT</code>, <code>VT</code>]=<em><code>{}</code></em>)</p>
</blockquote>
<p>Read documents from mongo as <code>pandas.DataFrame</code></p>
<h2 id="Parameters">Parameters<a class="anchor-link" href="#Parameters"> </a></h2><p>mongo_client: MongoClient
    mongo connection client
db, col: str
    name of the key in the config file pointing to the database, collection name
query, fields: Dict
    specify the query and fields by passing a dictionary</p>
<h2 id="Returns">Returns<a class="anchor-link" href="#Returns"> </a></h2><p>pd.DataFrame
    mongo documents converted to a <code>DataFrame</code></p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">read_mongo</span><span class="p">(</span><span class="n">mongo_client</span><span class="p">,</span> <span class="s2">&quot;am_combiner&quot;</span><span class="p">,</span> <span class="s2">&quot;name_tokens&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;word_token&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;$in&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;alexandre&#39;</span><span class="p">,</span> <span class="s1">&#39;bissonnette&#39;</span><span class="p">]}})</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>_id</th>
      <th>word_token</th>
      <th>no_of_tokens</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>5f7c52911a7f6858192edad1</td>
      <td>alexandre</td>
      <td>4286</td>
    </tr>
    <tr>
      <th>1</th>
      <td>5f7c52911a7f6858193019ec</td>
      <td>bissonnette</td>
      <td>110</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Sending-data-to-mongo">Sending data to mongo<a class="anchor-link" href="#Sending-data-to-mongo"> </a></h2><p>We will also need an utility function to send a <code>pandas.DataFrame</code> to mongo:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="send_df_to_mongo" class="doc_header"><code>send_df_to_mongo</code><a href="https://git.uk/machine-learning/data-science-and-statistical-learning/am_combiner/tree/master/am_combiner/config.py#L107" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>send_df_to_mongo</code>(<strong><code>df</code></strong>:<code>DataFrame</code>, <strong><code>mongo_client</code></strong>:<code>MongoClient</code>, <strong><code>db</code></strong>:<code>str</code>, <strong><code>col</code></strong>:<code>str</code>)</p>
</blockquote>
<p>Send <code>pandas.DataFrame</code> to mongo</p>
<h2 id="Parameters">Parameters<a class="anchor-link" href="#Parameters"> </a></h2><p>df: pd.DataFrame
    the <code>DataFrame</code> to send to mongo
mongo_client: MongoClient
    mongo connection client
db, col: str
    name of the key in the config file pointing to the database, collection name</p>
<h2 id="Returns">Returns<a class="anchor-link" href="#Returns"> </a></h2><p>bool
    insertion status: <code>True</code> (success) or <code>False</code> (failure)</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

</div>
 

