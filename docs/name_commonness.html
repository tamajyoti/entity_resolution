---

title: Strategy


keywords: fastai
sidebar: home_sidebar



nb_path: "02_name_commonness.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: 02_name_commonness.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<center><strong style="font-size:40px">Name Commonness</strong></center>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Detailed-File-Updation-Strategy">Detailed File Updation Strategy<a class="anchor-link" href="#Detailed-File-Updation-Strategy"> </a></h2><p>To update the files in future we need to follow the steps listed below and it is aided by the functions <strong>get_mongo_entity</strong> and <strong>get_entity_tokens</strong></p>
<ol>
<li>Initialize the mongo cursor for the database which contains all the unique entities </li>
<li>Obtain all the unique names using the get_mongo_entity function. This updation can be done once a week/month as per our choice to keep the set of names up to date to the mongo db</li>
<li>Obtain the token count for each token for all the names obtained from mongo db using the get_entity_token function</li>
<li>Finally we can obtain the two files while calculating any commonness score for any name of choice</li>
</ol>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="save_mongo_entity_to_csv" class="doc_header"><code>save_mongo_entity_to_csv</code><a href="https://git.uk/machine-learning/data-science-and-statistical-learning/am_combiner/tree/master/am_combiner/name_commonness.py#L18" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>save_mongo_entity_to_csv</code>(<strong><code>mongo_client</code></strong>:<code>MongoClient</code>, <strong><code>config</code></strong>:<code>Dict</code>[<code>KT</code>, <code>VT</code>], <strong><code>output_filename</code></strong>:<code>str</code>)</p>
</blockquote>
<p>Creates and updates a CSV with all the unique entity names present in the mongo db
based on the created mongo cursor.</p>
<h2 id="Parameters:">Parameters:<a class="anchor-link" href="#Parameters:"> </a></h2><p>mongo_client: MongoClient
    mongo connection to the desired cluster
config: Dict
    project config dictionary (usually read from json)
output_filename: str,
    The csv where the file needs to be updated</p>
<h2 id="Returns:">Returns:<a class="anchor-link" href="#Returns:"> </a></h2><p>None</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="save_entity_tokens_to_csv" class="doc_header"><code>save_entity_tokens_to_csv</code><a href="https://git.uk/machine-learning/data-science-and-statistical-learning/am_combiner/tree/master/am_combiner/name_commonness.py#L47" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>save_entity_tokens_to_csv</code>(<strong><code>names_csv</code></strong>:<code>str</code>, <strong><code>output_filename</code></strong>:<code>str</code>)</p>
</blockquote>
<p>The function reads all the entity names obtained from mongo and then transforms them
into individual tokens and then count the tokens. Finally it returns all the name tokens
and their individual counts which are stored in a csv file</p>
<h2 id="Parameters:">Parameters:<a class="anchor-link" href="#Parameters:"> </a></h2><p>names_csv: str,
    The csv file containing all the unique entity names from mongo db
output_filename: str,
    The csv file where all the entity name tokens and their total count is saved</p>
<h2 id="Returns:">Returns:<a class="anchor-link" href="#Returns:"> </a></h2><p>None</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Compute-Name-Commonness-Score">Compute Name Commonness Score<a class="anchor-link" href="#Compute-Name-Commonness-Score"> </a></h1><p>The strategy to compute name commonness score is fairly simple but it requires some data preparation described above:</p>
<ol>
<li>split the name into tokens</li>
<li>compute the empirical frequency of each token</li>
<li>multiply the frequency of each token to come up with the score. Note that this assumption is questionable 
as it assumes independence between </li>
</ol>
<p>The function <code>get_commonness_score()</code> implements this logic:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="get_commonness_score" class="doc_header"><code>get_commonness_score</code><a href="https://git.uk/machine-learning/data-science-and-statistical-learning/am_combiner/tree/master/am_combiner/name_commonness.py#L77" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>get_commonness_score</code>(<strong><code>entity_name</code></strong>:<code>str</code>, <strong><code>config</code></strong>:<code>Dict</code>[<code>KT</code>, <code>VT</code>], <strong><code>mongo_client</code></strong>:<code>MongoClient</code>, <strong><code>df_names_freq</code></strong>:<code>Optional</code>[<code>DataFrame</code>]=<em><code>None</code></em>, <strong><code>total_names</code></strong>:<code>Optional</code>[<code>int</code>]=<em><code>None</code></em>)</p>
</blockquote>
<p>Gives name commonness score for an entity name</p>
<h2 id="Parameters:">Parameters:<a class="anchor-link" href="#Parameters:"> </a></h2><p>entity_name: str,
    The entity name we want to get the score for
config: Dict
    project config dictionary (usually read from json)
df_name_freq: pd.DataFrame, optional
    The data frame containing all the name tokens and their count
total_name: int, optional
    The total no of names in our database</p>
<h2 id="Returns">Returns<a class="anchor-link" href="#Returns"> </a></h2><p>score: A name rank score for the entity name</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>In this first example, we show how we can make the computation based on data saved in csv format:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">all_names</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;/home/tarak/Downloads/name_com.csv&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">all_names</span><span class="p">[</span><span class="s2">&quot;Name commonness score&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">all_names</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">get_commonness_score</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;Name for Name commonness&quot;</span><span class="p">],</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">df_names_freq</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">df_all_names</span><span class="p">)),</span> 
                                                    <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">all_names</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s2">&quot;/home/tarak/Downloads/name_com.csv&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Name we make the same computation using only mongo-db data. Obviously, this computation is slower and should not be done
in production but at least we have the option to do it on the fly. An alternative is to extract the data from mongo and save it as csv and then pass it to the function if we are planning to call the function many times:</p>

</div>
</div>
</div>
</div>
 

