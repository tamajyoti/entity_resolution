---

title: Config


keywords: fastai
sidebar: home_sidebar



nb_path: "00_benchmark.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: 00_benchmark.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<center><strong style="font-size:40px">Benchmark</strong></center>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Here we recycle the old implementation. We start by documenting the code, add some comments and provide a working example.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Then, we define some constatnts:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>In order to run the code in this notebook, we will need some input files stored in csv format. At the moment, they are stored in
<a href="https://drive.google.com/drive/folders/1j7z7lOerlL-PlOHXONZrlJwTQ7yT9Hry?usp=sharing">Google-drive</a> but should be moved to S3 bucket.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">INPUT_CSV_PATH</span> <span class="o">=</span> <span class="s2">&quot;/home/tarak/Documents/perso/company/Projects/combiner/csvs&quot;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Entity-Data">Entity Data<a class="anchor-link" href="#Entity-Data"> </a></h1>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Extract-the-data">Extract the data<a class="anchor-link" href="#Extract-the-data"> </a></h2><p>The first step is to filter the appropriate data for a given <code>entity_name</code>.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="get_entity_data" class="doc_header"><code>get_entity_data</code><a href="https://git.uk/machine-learning/data-science-and-statistical-learning/am_combiner/tree/master/am_combiner/benchmark.py#L101" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>get_entity_data</code>(<strong><code>dataframe</code></strong>:<code>DataFrame</code>, <strong><code>entity_name</code></strong>:<code>str</code>, <strong><code>path_to_csvs</code></strong>:<code>str</code>)</p>
</blockquote>
<p>Get entity data
If a csv file for a given entity name exists in <code>path_to_csvs</code> then we load that file.
If it does exist, then we just take entity information from the existing dataframe</p>
<h2 id="Parameters">Parameters<a class="anchor-link" href="#Parameters"> </a></h2><p>dataframe: pd.DataFrame
    dataframe with preloaded entities
entity_name: str
    entity name of interest. Information for this entity will either be taken from the <code>dataframe</code> param
or loaded from a csv from <code>path_to_csvs</code> param.
path_to_csvs: str
    the folder where csvs are stored</p>
<h2 id="Returns">Returns<a class="anchor-link" href="#Returns"> </a></h2><p>pd.DataFrame
    dataframe with columns <a href="/am_combinerbenchmark.html#TEXT_TITLE_COLUMN"><code>TEXT_TITLE_COLUMN</code></a> and <a href="/am_combinerbenchmark.html#NER_TAGS_COLUMN"><code>NER_TAGS_COLUMN</code></a></p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">entity_name</span> <span class="o">=</span> <span class="s2">&quot;Abraham Aguayo&quot;</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">INPUT_CSV_PATH</span><span class="p">,</span> <span class="s1">&#39;input_data.csv&#39;</span><span class="p">))</span>
<span class="n">entity_info</span> <span class="o">=</span> <span class="n">get_entity_data</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">entity_name</span><span class="p">,</span> <span class="n">INPUT_CSV_PATH</span><span class="p">)</span>
<span class="n">entity_info</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>text_title</th>
      <th>ner_tags</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>http://www.montereycountyweekly.com/blogs/news...</td>
      <td>[(King City, GPE), (King City, GPE), (South Co...</td>
    </tr>
    <tr>
      <th>1</th>
      <td>http://www.montereycountyweekly.com/opinion/lo...</td>
      <td>[(King City, GPE), (King City Police Departmen...</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Reformat-the-entity-data">Reformat the entity data<a class="anchor-link" href="#Reformat-the-entity-data"> </a></h2><p>The next step is to reformat the entity <code>DataFrame</code> in a more convenient way. We will organise it according to <code>NER_TAG_TYPE</code> with one column per <code>NER_TAG_TYPE</code>.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">entity_pivoted_info</span> <span class="o">=</span> <span class="n">_get_pivot_data</span><span class="p">(</span><span class="n">entity_info</span><span class="p">)</span>
<span class="n">entity_pivoted_info</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>tag_type</th>
      <th>CARDINAL</th>
      <th>DATE</th>
      <th>GPE</th>
      <th>LOC</th>
      <th>MONEY</th>
      <th>NORP</th>
      <th>ORDINAL</th>
      <th>ORG</th>
      <th>PERSON</th>
      <th>PRODUCT</th>
      <th>QUANTITY</th>
      <th>TIME</th>
    </tr>
    <tr>
      <th>text_title</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>http://www.montereycountyweekly.com/blogs/news_blog/towing-scheme-shmowing-scheme-here-s-what-else-the-king/article_25551f4c-1f6f-11e4-a689-001a4bcf6878.html-0</th>
      <td>[1, 15 or so, a third, one, three, two]</td>
      <td>[2001, 2012, April 17, February, Jan. 17, Janu...</td>
      <td>[Carmel Valley, King City, King City copÃƒÂ¢, ...</td>
      <td>[Hegwood, the King City Case :]</td>
      <td>[10,000]</td>
      <td>[Baldiviez, Oaxacans, Soledad]</td>
      <td>[first]</td>
      <td>[CA - Milestone Communications Inc., Carrillo,...</td>
      <td>[Abraham, Aguayo, Alejandrina Tirado, Alison G...</td>
      <td>NaN</td>
      <td>[about a mile]</td>
      <td>[an hour]</td>
    </tr>
    <tr>
      <th>http://www.montereycountyweekly.com/opinion/local_spin/king-city-police-corruption-case-expands-to-breathtaking-proportions/article_1428592a-2328-11e4-b904-001a4bcf6878.html-1</th>
      <td>[0, one, two]</td>
      <td>[Aug. 12, Aug. 8, February, May, just weeks, m...</td>
      <td>[Carmel Valley, King City, Marina, Monterey, M...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>[second, third]</td>
      <td>[CA - Milestone Communications Inc., Carrillo,...</td>
      <td>[Abraham, Bobby Carrillo, Carmel, Carrillo, Ca...</td>
      <td>[Explorer, Ã¢â€šÂ¬]</td>
      <td>NaN</td>
      <td>[night]</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Combine">Combine<a class="anchor-link" href="#Combine"> </a></h1>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="get_entity_adjacency_matrix" class="doc_header"><code>get_entity_adjacency_matrix</code><a href="https://git.uk/machine-learning/data-science-and-statistical-learning/am_combiner/tree/master/am_combiner/benchmark.py#L198" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>get_entity_adjacency_matrix</code>(<strong><code>entity_dataframe</code></strong>, <strong><code>column_name</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="get_connected_components" class="doc_header"><code>get_connected_components</code><a href="https://git.uk/machine-learning/data-science-and-statistical-learning/am_combiner/tree/master/am_combiner/benchmark.py#L214" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>get_connected_components</code>(<strong><code>entity_frame</code></strong>, <strong><code>adjacency_matrix</code></strong>)</p>
</blockquote>
<p>:param entity_frame: pandas DataFrame containing all snippets for an entity.
:param adjacency_matrix: adjacency matrix to used to construct an entity graph.
:return: number of clusters for the entity and a dataframe with cluster ids.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="combine_entities" class="doc_header"><code>combine_entities</code><a href="https://git.uk/machine-learning/data-science-and-statistical-learning/am_combiner/tree/master/am_combiner/benchmark.py#L236" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>combine_entities</code>(<strong><code>input_csv</code></strong>, <strong><code>path_to_csvs</code></strong>, <strong><code>output_folder</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Validate">Validate<a class="anchor-link" href="#Validate"> </a></h1>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="validate_combiner" class="doc_header"><code>validate_combiner</code><a href="https://git.uk/machine-learning/data-science-and-statistical-learning/am_combiner/tree/master/am_combiner/benchmark.py#L305" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>validate_combiner</code>(<strong><code>validation_csv</code></strong>, <strong><code>output_folder</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Production-script">Production script<a class="anchor-link" href="#Production-script"> </a></h1>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="<Command main>" class="doc_header"><code><Command main></code><a href="" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code><Command main></code>(<strong>*<code>args</code></strong>, <strong>**<code>kwargs</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

</div>
 

